h1. castoro-s3-adapter

h2. Install

<pre>
gem install castoro-s3-adapter-X-X-X.gem
</pre>

h2. Command (related to adapter)

It is a subcommand of castoro-s3-adapter as follows.

h3. castoro-s3-adapter setup

Create necessary configuration file by command for the adapter.
See below Usage.

<pre>
$ castoro-s3-adapter setup --help
Usage: castoro-s3-adapter setup [options]
    -v, --verbose                    verbose
    -f, --force                      Override config file
    -c, --conf <configfile>          Config file
</pre>

h3. castoro-s3-adapter start

Command for starting up the castoro-s3-adapter program.
See below Usage.

<pre>
$ castoro-s3-adapter start --help
Usage: castoro-s3-adapter start [options]
    -v, --verbose                    verbose
    -d, --daemon                     daemon mode
    -p, --pid <pidfile>              PID file (only for the daemon mode)
    -l, --log <logfile>              Log file (only for the daemon mode)
    -c, --conf <configfile>          Config file
    -e, --env <environment>          Execution environment
</pre>

h3. castoro-s3-adapter stop

Command for stopping the castoro-s3-adapter daemon program.
See below Usage.

<pre>
$ castoro-s3-adapter stop --help
Usage: castoro-s3-adapter stop [options]
    -v, --verbose                    verbose
    -f, --force                      force shutdown
    -p, --pid <pidfile>              PID file
</pre>

h2. init.d script sample.

/etc/init.d/castoro-s3-adapter

<pre>
#!/bin/sh
# castoro-s3-adapter start/stop script.
# chkconfig: - 85 15
# description: castoro-s3-adapter start/stop script.
. /etc/rc.d/init.d/functions

prog=castoro-s3-adapter

base=/usr/local/bin/castoro-s3-adapter
cnf=/etc/castoro/s3-adapter.conf
pid=/var/castoro/s3-adapter.pid
log=/var/castoro/s3-adapter.log
env=default

start() {
  echo $"Start Castoro-S3-Adapter ..."
  $base start -c $cnf -p $pid -l $log -e $env -d
}

stop() {
  echo $"Stop Castoro-S3-Adapter ..."
  $base stop -p $pid
}

case "$1" in
  start)
    start
    ;;
  stop)
    stop
    ;;
  restart)
    stop
    start
    ;;
  status)
    status -p $pid $prog
    ;;
  *)
    echo $"Usage: $prog {start|stop|restart|status}"
esac
</pre>

h2. s3-adapter config file details.

Config file is based on the YAML format.

h3. example

<pre>
---
default: 
  loglevel: 1
  console_allow_host: 0.0.0.0
  logger: " Proc.new { |logfile| Logger.new(logfile) } "
  server_host: 0.0.0.0
  user: castoro
  server_port: 10080
  console_port: 30101
  nfs_root: /nfs
  client:
    gateways:
    - peer100
    - peer200
</pre>

h3. s3-adapter.conf attributes

|name of attribute|type|default|details|
|loglevel|Integer|1 (Logger::INFO)|logger level. must set to be between 0 and 5.|
|console_allow_host|Integer|0.0.0.0|Host address for console.|
|logger|String|<code>" Proc.new { |logfile| Logger.new(logfile) } "</code>|logger instance generate procedure.|
|server_host|Integer|0.0.0.0|Host Address for web server.|
|user|String|castoro|effective user for s3-adapter program.|
|server_port|Integer|10080|Port number for web server.|
|console_port|Integer|30101|Port number for console.|
|nfs_root|String|/nfs|NFS mount point.|
|client|Hash|<code>{ "gateways" = ["peer100"],["peer200"] }</code>}|castoro-client options.|
